<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Disc Dash JS</title>
  <link rel="stylesheet" href="css/main.css" type="text/css">
  <script src="js/disc.js"></script>
</head>
<body onresize="resize()">
  <span id="period">period in ms</span>
  <span id="frequency" style="float:right">frequency in Hz</span>
  <canvas id="canvas"></canvas>
  <script>
  const SAMPLE_SIZE = 50;
  let canvas = document.getElementById("canvas");
  let periodElement = document.getElementById("period");
  let frequencyElement = document.getElementById("frequency");
  let context = canvas.getContext("2d");
  var WIDTH;
  var HEIGHT;
  function resize()
  {
    canvas.width = window.innerWidth || document.documentElement.clientWidth || document.body.clientWidth;
    canvas.height = window.innerHeight || document.documentElement.clientHeight || document.body.clientHeight;
    WIDTH = canvas.width;
    HEIGHT = canvas.height;
    context.fillRect(0, 0, WIDTH, HEIGHT);
  }
  var discs = [];
  function gameLoop()
  {
    context.fillStyle = "black";
    context.fillRect(0, 0, WIDTH, HEIGHT);
    discs = discs.filter(disc=> disc.alive);
    console.log(discs.length);
    for(const disc of discs)
    {
      disc.update(10);
      disc.draw();
    }
  }
  setInterval(gameLoop,1000/15);
  const newDisk = ()=>{discs.push(new Disc(canvas));};
  setInterval(newDisk,500);
  resize();
  var now,last,p;
  now = new Date().getTime();
  periods= [];
  canvas.addEventListener("mousemove",(e)=>
  {
    /*context.fillStyle = "white";
    context.fillRect(e.clientX,e.clientY, 1, 1);*/
    last = now;
    now = new Date().getTime();
    let p=now-last;
    periods.push(p);
    if(periods.length>SAMPLE_SIZE) {periods.shift();}
    const avgP = periods.reduce((a,b)=>a+b)/periods.length;
    const avgF = 1/avgP;
    periodElement.innerText = Math.floor(avgP) +" ms";
    frequencyElement.innerText = Math.floor(avgF*1000) +"/s";
  });

</script>
</body>
</html>
